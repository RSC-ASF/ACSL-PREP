<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACSL Prep - Master Computer Science Competitions</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <span class="logo-icon">◆</span>
                ACSL<span class="accent">Prep</span>
            </a>
            <div class="nav-menu">
                <a href="index.html" class="nav-link active">Home</a>
                <a href="pages/leaderboard.html" class="nav-link">Leaderboard</a>
                <div id="auth-nav" class="auth-nav">
                    <button id="sign-in-btn" class="btn btn-primary">Sign In</button>
                </div>
                <div id="user-nav" class="user-nav hidden">
                    <a href="pages/profile.html" class="nav-link profile-link">
                        <img id="user-avatar" src="" alt="Profile" class="user-avatar">
                        <span id="user-name"></span>
                    </a>
                    <button id="sign-out-btn" class="btn btn-secondary">Sign Out</button>
                </div>
            </div>
            <button class="nav-toggle" id="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <div class="page-container">
        <div class="page-header">
            <div class="container">
                <h1>Contest <span class="accent">Preparation</span></h1>
                <p>Choose your division and contest to start your preparation journey</p>

                <!-- Division Selector -->
                <div class="division-selector">
                    <button class="division-btn active" data-division="senior">
                        <span class="material-icons">school</span>
                        Senior / Intermediate
                    </button>
                    <button class="division-btn" data-division="junior">
                        <span class="material-icons">child_care</span>
                        Junior
                    </button>
                </div>
                <p class="division-note" id="division-note">Senior & Intermediate share the same topics and problems.
                </p>
            </div>
        </div>

        <div class="page-content">
            <div class="container">
                <!-- Carousel Navigation -->
                <div class="carousel-controls">
                    <button class="carousel-btn prev" id="prevBtn" aria-label="Previous contest">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M15 18l-6-6 6-6" />
                        </svg>
                    </button>
                    <div class="carousel-dots" id="carouselDots">
                        <button class="carousel-dot active" data-index="0" aria-label="Contest 1"></button>
                        <button class="carousel-dot" data-index="1" aria-label="Contest 2"></button>
                        <button class="carousel-dot" data-index="2" aria-label="Contest 3"></button>
                        <button class="carousel-dot" data-index="3" aria-label="Contest 4"></button>
                    </div>
                    <button class="carousel-btn next" id="nextBtn" aria-label="Next contest">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M9 18l6-6-6-6" />
                        </svg>
                    </button>
                </div>

                <div class="carousel-wrapper">
                    <div class="carousel-track" id="carouselTrack">
                        <!-- Contest cards rendered dynamically by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <span class="logo-icon">◆</span> ACSL<span class="accent">Prep</span>
                </div>
                <p class="footer-text">Helping students master computer science competitions.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 ACSLPrep. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <style>
        /* Division Selector */
        .division-selector {
            display: flex;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-lg);
            justify-content: center;
            flex-wrap: wrap;
        }

        .division-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.25s ease;
        }

        .division-btn:hover {
            border-color: var(--accent);
            color: var(--text-primary);
        }

        .division-btn.active {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--accent);
            color: var(--accent);
        }

        .division-btn .material-icons {
            font-size: 18px;
        }

        .division-note {
            margin-top: var(--spacing-md);
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Carousel Styles */
        .carousel-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .carousel-btn {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-full);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .carousel-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent);
            color: var(--accent);
            transform: scale(1.1);
        }

        .carousel-btn:active {
            transform: scale(0.95);
        }

        .carousel-dots {
            display: flex;
            gap: var(--spacing-sm);
        }

        .carousel-dot {
            width: 12px;
            height: 12px;
            border-radius: var(--radius-full);
            background: var(--border-color);
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .carousel-dot::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: var(--radius-full);
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }

        .carousel-dot:hover {
            background: var(--text-secondary);
        }

        .carousel-dot.active {
            background: var(--accent);
            transform: scale(1.2);
        }

        .carousel-dot.active::before {
            border-color: rgba(var(--accent-rgb), 0.3);
        }

        .carousel-wrapper {
            overflow: hidden;
            border-radius: var(--radius-lg);
            position: relative;
        }

        .carousel-track {
            display: flex;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform;
        }

        .contest-card-full {
            flex: 0 0 100%;
            min-width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: all var(--transition-normal);
            animation: cardSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes cardSlideIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .contest-card-full:hover {
            border-color: var(--border-light);
        }

        .contest-card-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-xl);
            padding: var(--spacing-xl);
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }

        .contest-card-header .contest-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--accent);
            opacity: 0.5;
        }

        .contest-info {
            flex: 1;
        }

        .contest-info h2 {
            font-size: 1.25rem;
            margin-bottom: var(--spacing-xs);
        }

        .contest-topics {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .progress-ring {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-full);
            border: 3px solid var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .progress-percent {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .contest-card-body {
            padding: var(--spacing-lg);
        }

        .problem-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-md);
        }

        .problem-type-card {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            padding: var(--spacing-lg);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }

        .problem-type-card:hover {
            border-color: var(--accent);
            background: var(--bg-tertiary);
        }

        .type-icon {
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .type-icon .material-icons {
            font-size: 2rem;
            color: var(--accent);
        }

        .type-info {
            flex: 1;
        }

        .type-info h3 {
            font-size: 1rem;
            margin-bottom: var(--spacing-xs);
        }

        .type-info p {
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin-bottom: var(--spacing-xs);
        }

        .problem-count {
            font-size: 0.75rem;
            color: var(--accent);
        }

        .type-arrow {
            color: var(--text-secondary);
            font-size: 1.25rem;
        }

        @media (max-width: 768px) {
            .contest-card-header {
                flex-wrap: wrap;
            }

            .contest-progress {
                width: 100%;
                display: flex;
                justify-content: center;
                margin-top: var(--spacing-md);
            }
        }
    </style>

    <!-- Firebase SDK -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/auth.js"></script>
    <script type="module">
        import { signInWithGoogle, handleSignOut } from './js/auth.js';
        import { auth, db, doc, getDoc } from './js/firebase-config.js';
        import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Setup navigation
        const navToggle = document.getElementById('nav-toggle');
        const navMenu = document.querySelector('.nav-menu');

        if (navToggle) {
            navToggle.addEventListener('click', () => {
                navMenu.classList.toggle('active');
            });
        }

        // Auth buttons
        document.getElementById('sign-in-btn')?.addEventListener('click', signInWithGoogle);
        document.getElementById('sign-out-btn')?.addEventListener('click', handleSignOut);

        // Division and Contest Data
        let currentDivision = 'senior';

        const divisionData = {
            senior: {
                note: 'Senior & Intermediate share the same topics and problems.',
                shortCounts: [36, 35, 34, 35],
                progCount: 10,
                contests: [
                    { num: 1, topics: 'Computer Number Systems • Recursive Functions • What Does This Program Do?' },
                    { num: 2, topics: 'Prefix/Infix/Postfix Notation • Bit-String Flicking • LISP' },
                    { num: 3, topics: 'Boolean Algebra • Data Structures • FSAs and Regular Expressions' },
                    { num: 4, topics: 'Graph Theory • Digital Electronics • Assembly Language' }
                ]
            },
            junior: {
                note: 'Junior division focuses on program tracing with different data structures each contest.',
                shortCounts: [36, 35, 34, 35],
                progCount: 10,
                contests: [
                    { num: 1, topics: 'Computer Number Systems • Recursive Functions • WDTPD: Branching' },
                    { num: 2, topics: 'Prefix/Infix/Postfix Notation • Bit-String Flicking • WDTPD: Looping' },
                    { num: 3, topics: 'Boolean Algebra • Data Structures • WDTPD: Arrays' },
                    { num: 4, topics: 'Graph Theory • Digital Electronics • WDTPD: Strings' }
                ]
            }
        };

        let currentIndex = 0;

        function renderContests() {
            const track = document.getElementById('carouselTrack');
            const data = divisionData[currentDivision];
            document.getElementById('division-note').textContent = data.note;

            track.innerHTML = data.contests.map((c, idx) => `
                <div class="contest-card-full" data-contest="${c.num}">
                    <div class="contest-card-header">
                        <div class="contest-number">0${c.num}</div>
                        <div class="contest-info">
                            <h2>Contest ${c.num}</h2>
                            <p class="contest-topics">${c.topics}</p>
                        </div>
                        <div class="contest-progress" id="contest${c.num}-progress">
                            <div class="progress-ring">
                                <span class="progress-percent">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="contest-card-body">
                        <div class="problem-types">
                            <a href="pages/lessons.html?contest=${c.num}&division=${currentDivision}" class="problem-type-card">
                                <div class="type-icon"><span class="material-icons">menu_book</span></div>
                                <div class="type-info">
                                    <h3>Lessons</h3>
                                    <p>Learn the concepts and theory</p>
                                    <span class="problem-count">3 topics</span>
                                </div>
                                <span class="type-arrow">→</span>
                            </a>
                            <a href="pages/short-problems.html?contest=${c.num}&division=${currentDivision}" class="problem-type-card">
                                <div class="type-icon"><span class="material-icons">edit_note</span></div>
                                <div class="type-info">
                                    <h3>Short Problems</h3>
                                    <p>${data.shortCounts[idx]} practice problems</p>
                                    <span class="problem-count">0 / ${data.shortCounts[idx]} completed</span>
                                </div>
                                <span class="type-arrow">→</span>
                            </a>
                            <a href="pages/programming.html?contest=${c.num}&division=${currentDivision}" class="problem-type-card">
                                <div class="type-icon"><span class="material-icons">code</span></div>
                                <div class="type-info">
                                    <h3>Programming Problems</h3>
                                    <p>Code solutions in Python, Java, or C++</p>
                                    <span class="problem-count">0 / ${data.progCount} completed</span>
                                </div>
                                <span class="type-arrow">→</span>
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');

            // Reset carousel position
            track.style.transform = 'translateX(0)';
            currentIndex = 0;
            document.querySelectorAll('.carousel-dot').forEach((d, i) => d.classList.toggle('active', i === 0));
        }

        // Division selector
        document.querySelectorAll('.division-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.division-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentDivision = btn.dataset.division;
                localStorage.setItem('acsl-division', currentDivision);
                renderContests();
            });
        });

        // Load saved division
        const savedDivision = localStorage.getItem('acsl-division');
        if (savedDivision && divisionData[savedDivision]) {
            currentDivision = savedDivision;
            document.querySelectorAll('.division-btn').forEach(b => {
                b.classList.toggle('active', b.dataset.division === savedDivision);
            });
        }

        // Initial render
        renderContests();

        // Load user progress
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (userDoc.exists()) {
                    const progress = userDoc.data().progress;
                    const data = divisionData[currentDivision];
                    // Update progress display for each contest
                    for (let i = 1; i <= 4; i++) {
                        const contestProgress = progress[`contest${i}`];
                        if (contestProgress) {
                            const shortCompleted = contestProgress.short?.length || 0;
                            const progCompleted = contestProgress.programming?.length || 0;
                            const shortTotal = data.shortCounts[i - 1];
                            const progTotal = data.progCount;
                            const total = shortTotal + progTotal;
                            const percent = Math.round(((shortCompleted + progCompleted) / total) * 100);

                            const progressEl = document.querySelector(`#contest${i}-progress .progress-percent`);
                            if (progressEl) {
                                progressEl.textContent = `${percent}%`;
                            }

                            // Update problem counts
                            const card = document.querySelector(`[data-contest="${i}"]`);
                            if (card) {
                                const counts = card.querySelectorAll('.problem-count');
                                if (counts[1]) counts[1].textContent = `${shortCompleted} / ${shortTotal} completed`;
                                if (counts[2]) counts[2].textContent = `${progCompleted} / ${progTotal} completed`;
                            }
                        }
                    }
                }
            }
        });

        // Carousel functionality
        const track = document.getElementById('carouselTrack');
        const dots = document.querySelectorAll('.carousel-dot');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const totalSlides = 4;

        function updateCarousel(index, instant = false) {
            if (instant) {
                track.style.transition = 'none';
            } else {
                track.style.transition = 'transform 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
            }
            track.style.transform = `translateX(-${index * 100}%)`;

            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });

            currentIndex = index;
        }

        prevBtn.addEventListener('click', () => {
            const newIndex = currentIndex === 0 ? totalSlides - 1 : currentIndex - 1;
            updateCarousel(newIndex);
        });

        nextBtn.addEventListener('click', () => {
            const newIndex = currentIndex === totalSlides - 1 ? 0 : currentIndex + 1;
            updateCarousel(newIndex);
        });

        dots.forEach(dot => {
            dot.addEventListener('click', () => {
                updateCarousel(parseInt(dot.dataset.index));
            });
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                const newIndex = currentIndex === 0 ? totalSlides - 1 : currentIndex - 1;
                updateCarousel(newIndex);
            } else if (e.key === 'ArrowRight') {
                const newIndex = currentIndex === totalSlides - 1 ? 0 : currentIndex + 1;
                updateCarousel(newIndex);
            }
        });

        // Touch/swipe support
        let touchStartX = 0;
        let touchEndX = 0;

        track.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });

        track.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            const diff = touchStartX - touchEndX;

            if (Math.abs(diff) > 50) {
                if (diff > 0) {
                    // Swipe left - next
                    const newIndex = currentIndex === totalSlides - 1 ? 0 : currentIndex + 1;
                    updateCarousel(newIndex);
                } else {
                    // Swipe right - prev
                    const newIndex = currentIndex === 0 ? totalSlides - 1 : currentIndex - 1;
                    updateCarousel(newIndex);
                }
            }
        }, { passive: true });
    </script>
</body>

</html>